.. _rust-db-coll:

=========================
Databases and Collections
=========================

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecol

Overview
--------

In this guide, you can learn how to use the {+driver-short+} to access
and manage MongoDB databases and collections.

MongoDB organizes data in a hierarchal structure, in which data exist as
**documents** that are grouped into **collections**. A **database** stores
one or more collections.

To learn more about the document data format,
see :manual:`Documents </core/document/>` in the Server manual.

Access a Database
-----------------

You can access a database by using the following methods on a ``Client``
instance:

- ``database()``: access a database by its name
- ``database_with_options()``: set options while accessing a database
- ``default_database()``: access the default database specified in the
  ``ClientOptions`` instance or connection string used to create the
  ``Client`` instance

The preceding methods return a ``Database`` instance, which you can use
to perform database-level operations and access collections.

The following example uses the ``database()`` method to access a
database called ``test_db``:

.. literalinclude:: /includes/fundamentals/code-snippets/db-coll.rs
   :language: rust
   :dedent:
   :start-after: start-database
   :end-before: end-database

Access a Collection
-------------------

Use the `getCollection()
<{+api+}/apidocs/mongodb-driver-sync/com/mongodb/client/MongoDatabase.html#getCollection(java.lang.String)>`__
method of a ``MongoDatabase`` instance to access a
``MongoCollection`` in a database of your connected MongoDB instance.

The following example accesses a collection named "testCollection" from
a ``MongoDatabase``:

.. code-block:: java

   MongoDatabase database = mongoClient.getDatabase("testDatabase");
   MongoCollection<Document> collection = database.getCollection("testCollection");

.. tip::

   If the provided collection name does not already exist in the database,
   MongoDB implicitly creates the collection when you first insert data
   into that collection.

Create a Collection
-------------------

Use the `createCollection()
<{+api+}/apidocs/mongodb-driver-sync/com/mongodb/client/MongoDatabase.html#createCollection(java.lang.String,com.mongodb.client.model.CreateCollectionOptions)>`__
method of a ``MongoDatabase`` instance to create a collection
in a database of your connected MongoDB instance.

The following example creates a collection called "exampleCollection":


.. code-block:: java

   database.createCollection("exampleCollection");

You can specify collection options like maximum size and document
validation rules using the `CreateCollectionOptions
<{+api+}/apidocs/mongodb-driver-core/com/mongodb/client/model/CreateCollectionOptions.html>`__
class. The ``createCollection()`` method accepts an instance of
``CreateCollectionOptions`` as an optional second parameter.

Document Validation
~~~~~~~~~~~~~~~~~~~

**Document validation** provides the ability to validate documents
against a series of filters during writes to a collection. You can
specify these filters using the `ValidationOptions
<{+api+}/apidocs/mongodb-driver-core/com/mongodb/client/model/ValidationOptions.html>`__
class, which accepts a series of `Filters
<{+api+}/apidocs/mongodb-driver-core/com/mongodb/client/model/Filters.html>`__
that specifies the validation rules and expressions:

.. code-block:: java

   ValidationOptions collOptions = new ValidationOptions().validator(
       Filters.or(Filters.exists("commander"), Filters.exists("first officer")));
   database.createCollection("ships",
       new CreateCollectionOptions().validationOptions(collOptions));

For more information, see the server documentation for :manual:`document
validation </core/document-validation>`.

Get a List of Collections
-------------------------

You can query for a list of collections in a database using the
`MongoDatabase.listCollectionNames()
<{+api+}/apidocs/mongodb-driver-sync/com/mongodb/client/MongoDatabase.html#listCollectionNames()>`__ method:

.. code-block:: java

   for (String name : database.listCollectionNames()) {
       System.out.println(name);
   }

Drop a Collection
-----------------

You can remove a collection from the database using the 
`MongoCollection.drop()
<{+api+}/apidocs/mongodb-driver-sync/com/mongodb/client/MongoCollection.html#drop()>`__ method:

.. code-block:: java

   MongoCollection<Document> collection = database.getCollection("bass");
   collection.drop();

.. warning:: Dropping a Collection Deletes All Data in the Collection

   Dropping a collection from your database also permanently deletes all
   documents within that collection and all indexes on that collection.
   Only drop collections that contain data that is no longer needed.

.. _java-read-write-pref:

Specify Read Preferences, Read Concerns, and  Write Concerns
------------------------------------------------------------

**Read preferences**, **read concerns**, and **write concerns** control
how the driver routes read operations and waits for acknowledgment for
read and write operations when connected to a MongoDB replica set.
Read preferences and read concerns apply to all read operations;
write concerns apply to all write operations.

``MongoDatabase`` instances inherit their write concern, read concern,
and write preference settings from the ``MongoClient`` used to create
them. ``MongoCollection`` instances inherit their write concern, read concern,
and write preference settings from the ``MongoDatabase`` used to create
them. However, you can use the following methods to obtain an instance
of a ``MongoDatabase`` or ``MongoCollection`` with a read preference,
read concern, or write concern that differs from the setting they would
normally inherit:

- `MongoDatabase.withReadConcern() <{+api+}/apidocs/mongodb-driver-sync/com/mongodb/client/MongoDatabase.html#withReadConcern(com.mongodb.ReadConcern)>`__

- `MongoDatabase.withReadPreference() <{+api+}/apidocs/mongodb-driver-sync/com/mongodb/client/MongoDatabase.html#withReadPreference(com.mongodb.ReadPreference)>`__

- `MongoDatabase.withWriteConcern() <{+api+}/apidocs/mongodb-driver-sync/com/mongodb/client/MongoDatabase.html#withWriteConcern(com.mongodb.WriteConcern)>`__

- `MongoCollection.withReadConcern() <{+api+}/apidocs/mongodb-driver-sync/com/mongodb/client/MongoCollection.html#withReadConcern(com.mongodb.ReadConcern)>`__

- `MongoCollection.withReadPreference() <{+api+}/apidocs/mongodb-driver-sync/com/mongodb/client/MongoCollection.html#withReadPreference(com.mongodb.ReadPreference)>`__

- `MongoCollection.withWriteConcern() <{+api+}/apidocs/mongodb-driver-sync/com/mongodb/client/MongoCollection.html#withWriteConcern(com.mongodb.WriteConcern)>`__

.. tip::

   The ``withReadConcern()``, ``withReadPreference()``, and
   ``withWriteConcern`` methods create a new instance of a
   ``MongoDatabase`` or ``MongoCollection`` with the desired preference
   or concern. The ``MongoDatabase`` or ``MongoCollection`` upon which
   the method is called retains its original preference and concern
   settings.

For more information, see the server documentation on
:manual:`read preferences </core/read-preference/>`,
:manual:`read concerns </reference/read-concern/>`, and
:manual:`write concerns </reference/write-concern/>`.