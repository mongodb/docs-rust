.. _rust-fundamentals-query-document:

===============
Specify a Query
===============

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

Overview
--------

Most CRUD operations allow you to narrow the set of matched documents by
specifying matching criteria in a **query document**. Query documents contain
one or more query operators that apply to specific fields which determine which
documents to include in the result set.

In a query document, you can match fields against literal values, such as
``{ title: 'The Room' }``, or you can compose
:manual:`query operators </reference/operator/query/>` to express more
complex matching criteria. In this guide, we cover the following categories
of query operators in MongoDB and show examples on how to use them:

- :manual:`Comparison Operators </reference/operator/query-comparison/>`

- :manual:`Logical Operators </reference/operator/query-logical/>`

- :manual:`Element Operators </reference/operator/query-element/>`

- :manual:`Evaluation Operators </reference/operator/query-evaluation/>`

The examples in this guide use the following sample documents. Each
document represents a fruit in a store's inventory, and contains
information about its quantity, and its rating:


.. code-block:: rust

   { "_id": 1, "name": "orange", "quantity": 7, "rating": 5 },
   { "_id": 2, "name": "apple", "quantity": 4, "rating": 6, "description": "a red or green fruit" },
   { "_id": 3, "name": "banana", "quantity": 36, "rating": 8 },
   { "_id": 4, "name": "pear", "quantity": 28, "rating": 4 }

Literal Value Queries
---------------------

Literal value queries allow you to query for data that exactly matches
a value you provide in the query document. A literal value query has two
parts: a field name and a value. Documents returned from such a query
must contain a field that has exactly the same name as the provided name
and a value for that field that is exactly the same as the provided
value. The following operation uses a literal query to search for
documents containing a field called "name" that has a value of "pear":

.. code-block:: rust

   let query = doc! { "name": "pear" };
   let find_options = FindOptions::builder().sort(doc! { "title": 1 }).build();
   let mut cursor = myColl.find(query, find_options).await?;
   while let Some(Document) = cursor.try_next().await? {
     println!("{}", Document);
   }

This code snippet returns the following results:

.. code-block:: rust
   :copyable: false

   { "_id": 4, "name": "pear", "quantity": 28, "rating": 4 }

.. note::

  Literal value queries are equivalent to the ``$eq`` comparison
  operator. As a result, the following two queries are equivalent:

  .. code-block:: rust

      myColl.find(doc! {
         "rating": doc! { "$eq": 5 }
      }).await?;

  .. code-block:: rust

      myColl.find(doc! {
         "rating": 5
      }).await?;

Comparison Operators
--------------------

Comparison operators allow you to query for data based on comparisons
with values in a collection. Common comparison operators include
``$gt`` for "greater than" comparisons, ``$lt`` for "less than" comparisons,
and ``$ne`` for "not equal to" comparisons. The following operation uses
the comparison operator ``$gt`` to search for documents with a quantity
value greater than 5 and prints them out:

.. code-block:: rust

   // $gt means "greater than"
   let query = doc! { "quantity": doc! { $"gt": 5 } };
   let find_options = FindOptions::builder().sort(doc! { "title": 1 }).build();
   let mut cursor = myColl.find(query, find_options).await?;
   while let Some(Document) = cursor.try_next().await? {
     println!("{}", Document);
   }

This code snippet returns the following results:

.. code-block:: javascript
   :copyable: false

   { "_id": 1, "name": "orange", "qty": 6, "rating": 2 }
   { "_id": 2, "name": "banana", "qty": 7, "rating": 1 }
   { "_id": 4, "fruit": "pear", "quantity": 28, "rating": 4 }

Logical Operators
-----------------

Logical operators allow you to query for data using logic applied to the
results of field-level operators. For instance, you can use the ``$or``
method to query for documents that match either a ``$gt`` comparison
operator or a literal value query. The following operation uses the
logical operator ``$not`` to search for documents with a quantity value
that is not greater than 5 and prints them out:

.. code-block:: rust

   let query = doc! { "qty": doc! { "$not": doc! { "$gt": 5 }}};
   let find_options = FindOptions::builder().sort(doc! { "title": 1 }).build();
   let mut cursor = myColl.find(query, find_options).await?;
   while let Some(Document) = cursor.try_next().await? {
     println!("{}", Document);
   }

This code snippet returns the following results:

.. code-block:: rust
   :copyable: false

   { "_id": 2, "fruit": "apple", "quantity": 4, "rating": 6, "description": "a red or green fruit" }

.. note::

  Whenever a query document contains multiple elements, those elements
  are combined together with an implicit ``$and`` logical operator to
  figure out which documents match the query. As a result, the following
  two queries are equivalent:

  .. code-block:: rust

     myColl.find(doc! {
       "rating": doc! { "$eq": 5 },
       "qty": doc! { "$gt": 4 }
     });

  .. code-block:: rust

     myColl.find(doc! {
       $and: [
          doc! { "rating": { "$eq": 5 }},
          doc! { "qty": { "$gt": 4 }}
       ]
     });

For more information on comparison operators, see the reference manual
entry for :manual:`Comparison Query Operators </reference/operator/query-comparison/>`.

Element Operators
-----------------

Element operators allow you to query based on the presence, absence, or
type of field. The following operation uses the element operator
``$exists`` to search for documents containing the ``description``
field:

.. code-block:: rust

   let query = doc! { "description": doc! { "$exists": true } };
   let find_options = FindOptions::builder().build();
   let mut cursor = myColl.find(query, find_options);
   while let Some(Document) = cursor.try_next().await? {
     println!("{}", Document);
   }

This code snippet returns the following results:

.. code-block:: rust
   :copyable: false

   { "_id": 2, "fruit": "apple", "quantity": 4, "rating": 6, "description": "a red or green fruit" }

For more information on this operator, see the reference manual entry for
the :manual:`$exists operator </reference/operator/query/exists/>`.

Evaluation Operators
--------------------

Evaluation operators allow you to execute higher-level logic, like
regex and text searches, when querying for documents in a collection.
Common evaluation operators include ``$regex`` and ``$text``.
The following operation uses the evaluation operator ``$mod`` to search
for documents with a quantity value that is divisible by 3 with
a remainder of 0:

.. code-block:: javascript

   // $mod means "modulo" and returns the remainder after division
   let query = doc! { "qty": doc! { "$mod": [ 3, 0 ] } };
   let find_options = FindOptions::builder().build();
   let mut cursor = myColl.find(query, find_options);
   while let Some(Document) = cursor.try_next().await? {
     println!("{}", Document);
   }

This code snippet returns the following results:

.. code-block:: javascript
   :copyable: false

   { "_id": 3, "fruit": "banana", "quantity": 36, "rating": 8 }

For more information on this operator, see the reference manual entry for
the :manual:`$mod operator </reference/operator/query/mod/>`.
